
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/8.4.2/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/8.4.2/firebase-auth.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-database.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-firestore.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-functions.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-messaging.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-storage.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-analytics.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-remote-config.js"></script>
    <script defer src="/__/firebase/8.4.2/firebase-performance.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>

    <style media="screen">
      body { background: #302f2c; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0;}
      #message { background: white; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; }
      #message h2 { color: #0074b8; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      #botones {  background-color: #fafafa; margin: 1rem padding: 1rem; border: 2px solid #0074b8;text-align: center; margin-left: 20%; margin-right: 20%;}
      #demo {font-family: "Times New Roman"; background-color: #fafafa;  border: 2px solid #0074b8;text-align: center; margin-left: 20%; margin-right: 20%; padding: 32px 24px; border-radius: 3px;}
      #demo2 {font-family: "Times New Roman"; background-color: #fafafa;  border: 2px solid #0074b8;text-align: center; margin-left: 20%; margin-right: 20%; padding: 32px 24px; border-radius: 3px;}
      #demo3 {font-family:"Times New Roman"; background-color: #fafafa;  border: 2px solid #0074b8;  text-align: center; padding: 32px 24px; margin-left: 20%;  margin-right: 20%; border-radius: 3px;}
      #demo5 {font-family: "Times New Roman"; background-color: #fafafa;  border: 2px solid #0074b8; text-align: center; padding: 32px 24px; margin-left: 20%; margin-right: 20%; border-radius: 3px;}
      #demo4 {font-family: "Times New Roman"; background-color: #fafafa;  border: 2px solid #0074b8; text-align: center; padding: 32px 24px; margin-left: 20%; margin-right: 20%; border-radius: 3px;}
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: white; box-shadow: none; }
        body { border-top: 16px solid #ffa100; }
      }
    </style>
  </head>
  <body>
	  

	
	</div>
	
	

<script>
	//funció que carrega contingut html a partir de una crida a una funcio GCP
	function loadDoc() {
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
	  //load the video-shots in "demo"
      document.getElementById("demo").innerHTML =
      this.responseText;
		}
	};
	var file = document.getElementById('input').files[0];
	//http-get call video-shots gcp function
	xhttp.open("GET", "https://europe-west1-sm5-hackaton.cloudfunctions.net/function-1?video="+document.getElementById('input').files[0].name, true);
	xhttp.send();
}
</script>
<script>
	//funció que carrega contingut html a partir de una crida a una funcio GCP. Passem com a paràmetre el nom del arxiu.
	function loadDoc2() {
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
		//load the labbels in "demo2"
      document.getElementById("demo2").innerHTML =
      this.responseText;
		}
	};
	var file = document.getElementById('input').files[0];
	//http-get call video-labelling gcp function. Passem com a paràmetre el nom del arxiu.
	xhttp.open("GET", "https://europe-west1-sm5-hackaton.cloudfunctions.net/function-3?video="+document.getElementById('input').files[0].name, true);
	xhttp.send();
}
</script>
<script>
	//funció que carrega contingut html a partir de una crida a una funcio GCP
	function loadDoc3() {
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
		//si obtenim resposta, confirmem que els subtítuls s'han generat correctament.
      document.getElementById("demo3").innerHTML ="Los subtitulos se han generado correctamente";
		}
	};
	var file = document.getElementById('input').files[0];
	//crida a la funció speech2text de gcp per generar subtítols. Passem com a paràmetres el nom de l'arxiu i addicionalment l'idioma.
	xhttp.open("GET", "https://europe-west1-sm5-hackaton.cloudfunctions.net/Speech2text?video="+document.getElementById('input').files[0].name+"&language="+document.getElementById('language').value, true);
	xhttp.send();
	return false;
}
</script>


<script>
	//funció que carrega contingut html a partir de una crida a una funcio GCP
	function loadDoc4() {
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("demo4").innerHTML =this.responseText;
       
		}
	};
	var file = document.getElementById('input').files[0];
	//crida a la funció2 que permet realitzar la fusió del video amb els subtítols.
	xhttp.open("GET", "https://europe-west2-sm5-hackaton.cloudfunctions.net/function-2?video="+document.getElementById('input').files[0].name, true);
	xhttp.send();
}
</script>
    <script>
    function loadDoc5() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    document.getElementById("demo5").innerHTML ="Los subtitulos se han traducido correctamente";
    }
    };
    var file = document.getElementById('input').files[0];
    //crida a la funció Translation de GCP. Passem com a paràmetre l'arxiu i l'idioma de traducció
    xhttp.open("GET", "https://us-central1-sm5-hackaton.cloudfunctions.net/Translation?video="+document.getElementById('input').files[0].name+"&language="+document.getElementById('languagetrad').value, true);
    xhttp.send();
    return false;
    }
    </script>

    <div id="message">
      <h2>Welcome to Video Modifiers</h2>
      <h1>Tratamiento de vídeo via Google VideoIntelligence API2</h1>
    </div>
	<script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-storage.js"></script>


    <div id="botones">
    <input type="file" id="input" multiple />
    <button  id="b1" onclick="upload()">Subir archivo para ser analizado </button>
    </div>

    <div id="botones">
        <p>Mostrar los frames claves del video:</p>
    <button type="button" onclick="loadDoc()">Mostrar frames</button>
    </div>
    <div id="demo">
        <h1></h1>
    </div>

    <div id="botones">
        <p>Etiquetar el video segun su contenido:</p>
	 <button type="button" onclick="loadDoc2()">Etiquetas del vídeo</button>
    </div>
	 <div id="demo2">
		 <h1></h1>
	 </div>

    <div id="botones">
    <p>Selecciona el idioma del video para generar subtitulos (Puede tardar algunos minutos):</p>
     <select id="language" name="language">
         <option value="en-GB" selected = "selected">Ingles</option>
         <option value="es-US">Español</option>
         <option value="it-IT">Italiano</option>
         <option value="de-DE">Aleman</option>
         <option value="fr-FR">Francés</option>
     </select>
	 <button type="button" onclick="loadDoc3()">Generar subtítulos</button>
    </div>
	 <div id="demo3">
		 <h1></h1>
	</div>

    <div id="botones">
    <p>Selecciona el idioma al que traducir los subtitulos del video:</p>
    <select id="languagetrad" name="languagetrad">
        <option value="en-GB" selected = "selected">Ingles</option>
        <option value="es-US">Español</option>
        <option value="it-IT">Italiano</option>
        <option value="de-DE">Aleman</option>
        <option value="fr-FR">Francés</option>
    </select>
    <button type="button" onclick="loadDoc5()">Traducir subtítulos</button>
    </div>
    <div id="demo5">
        <h1></h1>
    </div>

    <div id="botones">
        <p>Generar video con subtitulos (Puede tardar algunos minutos):</p>
	 <button type="button" onclick="loadDoc4()">Fusionar subtítulos y video</button>
    </div>
	 <div id="demo4">
		 <h1></h1>
	</div>

    <div id="botones">
	 <button type="button" onclick="update_vid()">Actualizar vídeo</button>
    </div>

    <div id="botones">
	<h1></h1>
	<video  id="myVideo" width="320" height="240" controls>
	<source src=""  type="video/mp4">
	<track  default id="mytrack" src="" />
	
	Your browser does not support the video tag.
	</video>
	<script>
		//funció per actualitzar el video una vegada s'han efectuat els canvis, com per exemple la fusió de subtítols amb el v
		function update_vid()
		{
		file=document.getElementById('input').files[0].name
		name=file.substr(0, file.lastIndexOf('.'))
		document.getElementById("myVideo").src = 'https://firebasestorage.googleapis.com/v0/b/sm5-hackaton.appspot.com/o/video%2F'+name+"_subs.mp4?alt=media";
		document.getElementById("myVideo").load();
	}
	</script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
      
        try {
          let app = firebase.app();
          let features = [
            'auth', 
            'database', 
            'firestore',
            'functions',
            'messaging', 
            'storage', 
            'analytics', 
            'remoteConfig',
            'performance',
          ].filter(feature => typeof app[feature] === 'function');
    
        } catch (e) {
          console.error(e);
          loadEl.textContent = 'Error loading the Firebase SDK, check the console.';
        }
      });
      
      
		  // Your web app's Firebase configuration
		  var firebaseConfig = {
			apiKey: "AIzaSyBX8Fh-1PyWPbj2s4lqr5IpODigldwsXZ0",
			authDomain: "sm5-hackaton.firebaseapp.com",
			projectId: "sm5-hackaton",
			storageBucket: "sm5-hackaton.appspot.com",
			messagingSenderId: "499343893697",
			appId: "1:499343893697:web:a1d26eba4101031bca2040"
		  };
		  
 
    </script>
     <script>
	   function upload(){
		// Get a reference to the storage service, which is used to create references in your storage bucket
		var storage = firebase.storage();

		// Create a root reference
		//var storageRef = firebase.storage().ref('me/' + file.name);
		var storageRef = firebase.storage().ref();
		var file = document.getElementById('input').files[0];
		console.log(file);
		// Create a reference to 'mountains.jpg'
		var thisRef = storageRef.child(file.name);

		// Create a reference to 'images/mountains.jpg'
		//var mountainImagesRef = storageRef.child('images/mountains.jpg');

		
		//console.log(file);
		var metadata = {
		contentType: 'video/mpeg-4'
		};
		// Upload file and metadata to the object 'images/mountains.jpg'
		var uploadTask = storageRef.child('video/' + file.name).put(file, metadata);

		// Listen for state changes, errors, and completion of the upload.
		uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
			function(snapshot) {
				// Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
				var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
				console.log('Upload is ' + progress + '% done');
				switch (snapshot.state) {
				case firebase.storage.TaskState.PAUSED: // or 'paused'
					console.log('Upload is paused');
					break;
				case firebase.storage.TaskState.RUNNING: // or 'running'
					console.log('Upload is running');
					break;
				}
			}, 
			function(error) {

			  // A full list of error codes is available at
			  // https://firebase.google.com/docs/storage/web/handle-errors
			  switch (error.code) {
				case 'storage/unauthorized':
				  // User doesn't have permission to access the object
				  break;

				case 'storage/canceled':
				  // User canceled the upload
				  break;

				case 'storage/unknown':
				  // Unknown error occurred, inspect error.serverResponse
				  break;
				}
			}, 
			function() {
			  // Upload completed successfully, now we can get the download URL
			  uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
				console.log('File available at', downloadURL);
				document.getElementById("myVideo").src = downloadUrl;
			  });
			});
		}    
    </script>
    </div>
	
  </body>
</html>
